# CSA_HW4
ИДЗ №4 по дисциплине "Архитектура вычислительный систем".

# Информация о программе и тестах.
В данной программе одна единица компиляции (main).

В папке default_program находится программа, реализованная на основе семафоров.

В папке incorrect program находится аналогичная программа, но без использования синхронизации (в данном случае семафоров).

В папке tests представленные различные тесты для программы с использованием семафоров (default_program_tests) и с их отключением (incorect program tests).

Варианты запуска:
1. ./prog.out - считывание целого числа из консоли.
2. ./prog.out input_name output_name- считывание целого числа из файла c именем input_name, дальнейшая запись в файл с именем output_name (в файле должно находится только одно целое число).
3. ./prog.out output_name - случайная генерация целого числа (от 5 до 15), дальнейшая запись в файл с именем output_name.
# Входные и выходные данные.
В программе есть только один входной параметр - количество приемов пищи (от 1 до числа) для каждого из философов (все философы едят одинаковое количество раз). Количество секунд, требуемых на выполнение программы примерно в два раза больше, чем количество приёмов пищи, так что рекомендуется не вводить большие числа, так как запись результата из буфера производится только в конце программы.

Выходные данные содержат информацию о том, в какой последовательности ели философы каждый из своих приемов пищи, а также время, которое замерялось от начала трапезы и до окончанию текущего приёма пищи для философом.
# Алгоритм взятия вилок философами.
Cчиталось, что философы и вилки(') имеют номера 1,2,3,4,5 (с расположением 1', 1, 2', 2, 3', 3, 4',4 ,5' ,5), причём каждый из философов берёт соседнюю вилку с наибольшим номером. Таким образом избегалась ситуация, когда все философы голодны, но никто не может взять вилку (все вилки уже взяты).

Доказательство: Предположим, что такая ситация возможна. Тогда точно есть философ без вилки (ведь если у каждого философа есть вилка, то у каждого она ровно одна и  это вилка с наибольшим для него номером (потому что философы сначала берут её), но это невозможно, так как вилку 1 никто не может взять первой). А если есть философ без вилки, то из оставшихся четырёх существует философ, который должен держать две вилки (так как философов 4, а вилок 5). Следовательно противоречие и такая ситация невозможна.
# Описание программы.
Каждый из философов представлен экземпляром класса Philosopher, который содежржит номер философа, оставшееся количесвто приёмов пищи для него и поток, в котором будут выполняться действия данного философа.

Вилки представлены деком из пяти бинарных семафоров, каждый из которых отвечает за свою вилку.

Также в программе использовался бинарный семафора, предоставляющий потоку запись в буфер.

Перед каждым из приёмов пищи поток-философ ждал разблокировки семафоров, отвечающиех за вилки, нужные ему, дальше блокировал их, отправлялся в сон на 1 секунду (ел). После записывал изменения в буфер (с ожиданием разблокировки и последующей блокировкой семафора, отвечающего за изменения в буфере) и разблокировывал ранее заблокированные семафоры.
# Конфликтные ситуации.
1. При отключении семафоров, отвечающих за вилки, все потоки одновременно выполняли метод, отвечающий за поедание текущего приёма пищи.
2. При отключении семафора для изменения буфера, некоторые изменения не сохранялись (в той ситуации, когда одновременно два потока прочитали содержание буфера, изменения, сделанные одним из этих потоков, не сохранятся).

Все вышеперечисленные ситуации видны в тестах для программы с отключённой синхронизацией.
